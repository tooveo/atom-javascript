!function(t,e,a){"use strict";function s(t){t=t||{};var e="https://track.atom-data.io/",a="1.1.0";this.options={endpoint:!!t.endpoint&&t.endpoint.toString()||e,apiVersion:a,auth:t.auth?t.auth:""}}function r(t,e){this.endpoint=t.toString()||"",this.params=e||{},this.headers={contentType:"application/json;charset=UTF-8"},this.xhr=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}function n(t,e,a){this.error=t,this.response=e,this.status=a}function i(t){t=t||{},this.params=t,this.params.flushInterval=t.flushInterval?1e3*t.flushInterval:1e4,this.params.bulkLen=t.bulkLen?t.bulkLen:1e4,this.params.bulkSize=t.bulkSize?1024*t.bulkSize:65536,this.accumulated={},this.atom=new s(t),this.timer=null}function o(t){for(var e=[t],a=0,s=0;s<e.length;s++)switch(typeof e[s]){case"boolean":a+=4;break;case"number":a+=8;break;case"string":a+=2*e[s].length;break;case"object":if("[object Array]"!=Object.prototype.toString.call(e[s]))for(var r in e[s])a+=2*r.length;for(var r in e[s]){for(var n=!1,i=0;i<e.length;i++)if(e[i]===e[s][r]){n=!0;break}n||e.push(e[s][r])}}return a}t.IronSourceAtom=s,s.prototype.putEvent=function(t,e){if(t=t||{},!t.table)return e("Stream is required",null);if(!t.data)return e("Data is required",null);t.apiVersion=this.options.apiVersion,t.auth=this.options.auth;var a=new r(this.options.endpoint,t);return t.method&&"GET"===t.method.toUpperCase()?a.get(e):a.post(e)},s.prototype.putEvents=function(t,e){if(t=t||{},!t.table)return e("Stream is required",null);if(!(t.data&&t.data instanceof Array&&t.data.length))return e("Data (must be not empty array) is required",null);t.apiVersion=this.options.apiVersion,t.auth=this.options.auth;var a=new r(this.options.endpoint+"/bulk",t);return t.method&&"GET"===t.method.toUpperCase()?a.get(e):a.post(e)},s.prototype.health=function(t){var e=new r(this.options.endpoint,{table:"health_check",data:"null"});return e.get(t)},"undefined"!=typeof module&&module.exports&&(module.exports={IronSourceAtom:s,Request:r,Response:n,Tracker:i}),r.prototype.post=function(t){if(!this.params.table||!this.params.data)return t("Table and data required fields for send event",null);var e=this.xhr,a=JSON.stringify({data:this.params.data,table:this.params.table,apiVersion:this.params.apiVersion,auth:this.params.auth});e.open("POST",this.endpoint,!0),e.setRequestHeader("Content-type",this.headers.contentType),e.setRequestHeader("x-ironsource-atom-sdk-type","js"),e.setRequestHeader("x-ironsource-atom-sdk-version","1.0.1"),e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE){var a;e.status>=200&&e.status<400?(a=new n(!1,e.response,e.status),!!t&&t(null,a.data())):(a=new n(!0,e.response,e.status),!!t&&t(a.err(),null))}},e.send(a)},r.prototype.get=function(t){if(!this.params.table||!this.params.data)return t("Table and data required fields for send event",null);var e,a=this.xhr,s=JSON.stringify({table:this.params.table,data:this.params.data,apiVersion:this.params.apiVersion,auth:this.params.auth});try{e=btoa(s)}catch(r){}a.open("GET",this.endpoint+"?data="+e,!0),a.setRequestHeader("Content-type",this.headers.contentType),a.setRequestHeader("x-ironsource-atom-sdk-type","js"),a.setRequestHeader("x-ironsource-atom-sdk-version","1.0.1"),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE){var e;a.status>=200&&a.status<400?(e=new n(!1,a.response,a.status),!!t&&t(null,e.data())):(e=new n(!0,a.response,a.status),!!t&&t(e.err(),null))}},a.send()},n.prototype.data=function(){return this.error?null:JSON.parse(this.response)},n.prototype.err=function(){return{message:this.response,status:this.status}},t.Tracker=i,i.prototype.track=function(t,e){var s=this;return t!=a&&e!=a&&e.length?(s.accumulated[t]||(s.accumulated[t]=[]),s.accumulated[t].push(e),void(s.accumulated[t].length>=s.params.bulkLen||o(s.accumulated[t])>=s.params.bulkSize?s.flush(t):s.timer||(s.timer=setTimeout(function(){s.flush()},s.params.flushInterval)))):new Error("Stream or data empty")},i.prototype.flush=function(t,e,a){function s(t,e,a){return r.atom.putEvents({table:t,data:e},function(s,n){if(null!=s){if(!(s.status>=500))return new Error(s);if(!(6e5>a))return new Error("Server not response more then 10min.");setTimeout(function(){a=2*a,r.flush(t,e,a)},a)}})}var r=this;if(a=a||1e3,t&&e)s(t,e,a);else if(t&&!e)r.accumulated[t].length>=1&&s(t,r.accumulated[t]);else{for(var n in r.accumulated)r.accumulated[n].length>=1&&r.flush(n,r.accumulated[n]),r.accumulated[n]=[];r.timer=null}}}(window,document);