!function(t,e,r){"use strict";function n(t){t=t||{};var e="https://track.atom-data.io/",r="V1",n="1.5.1",i="atom-js";this.options={endpoint:t.endpoint||e,apiVersion:r,auth:t.auth||"",sdkVersion:t.sdkVersion?n+"+"+t.sdkVersion:n,sdkType:t.sdkType?i+"+"+t.sdkType:i}}function i(e){if(this.params=e||{},"string"!=typeof e.data&&!(e.data instanceof String))try{this.params.data=JSON.stringify(this.params.data)}catch(r){throw new Error("data is invalid - can't be stringified")}this.headers={contentType:"application/json;charset=UTF-8",sdkType:this.params.sdkType,sdkVersion:this.params.sdkVersion},"XDomainRequest"in t&&null!==t.XDomainRequest&&this._isIE()&&this._isIE()<10?(this.params.endpoint=this.params.endpoint.replace(/^(http|https):/,location.protocol),this.xhr=new XDomainRequest,this.oldBrowser=!0):(this.xhr=new XMLHttpRequest,this.oldBrowser=!1)}function s(t,e,r){this.error=t,this.response=e,this.status=r}function a(t){var e=this;this.retryTimeout=1e3,t=t||{},this.params=t,this.params.flushInterval=t.flushInterval?1e3*t.flushInterval:1e4,this.params.bulkLen=t.bulkLen?t.bulkLen:3,this.params.bulkSize=t.bulkSize?1024*t.bulkSize:10240,this.params.auth=t.auth?t.auth:"",this.accumulated={},this.atom=new n(t),this.timer||(this.timer=setInterval(function(){e.flush()},this.params.flushInterval))}function o(t){return encodeURI(t).split(/%..|./).length-1}function u(t,e){function r(t,r){t(function(t,s,a){if(n[r]={err:t,data:s,status:a},0===--i)return e(n)})}for(var n=[],i=t.length,s=0;s<t.length;s++)r(t[s],s)}t.IronSourceAtom=n,n.prototype.putEvent=function(t,e){if(t=t||{},!t.stream)return e("Stream is required",null,400);if(!t.data)return e("Data is required",null,400);t.apiVersion=this.options.apiVersion,t.sdkVersion=this.options.sdkVersion,t.sdkType=this.options.sdkType,t.auth=t.auth||this.options.auth,t.endpoint=t.endpoint||this.options.endpoint;var r=new i(t);return t.method&&"GET"===t.method.toUpperCase()?r.get(e):r.post(e)},n.prototype.putEvents=function(t,e){if(t=t||{},!t.stream)return e("Stream is required",null,400);if(!(t.data&&t.data instanceof Array&&t.data.length))return e("Data (must be not empty array) is required",null,400);if(t.method&&"GET"==t.method.toUpperCase())return e("GET is not a valid method for putEvents",null,400);t.apiVersion=this.options.apiVersion,t.auth=this.options.auth,t.sdkVersion=this.options.sdkVersion,t.sdkType=this.options.sdkType,t.endpoint=this.options.endpoint+"bulk";var r=new i(t);return r.post(e)},n.prototype.health=function(t){var e=this.options,r=new i(e);return r.health(t)},"undefined"!=typeof module&&module.exports&&(module.exports={IronSourceAtom:n,Request:i,Response:s,Tracker:a,taskMap:u}),i.prototype._isIE=function(){var t=navigator.userAgent.toLowerCase();return console.log("EXPLORER VERSION: "+t),t.indexOf("msie")!=-1&&parseInt(t.split("msie")[1])},i.prototype.post=function(t){if(!this.params.stream||!this.params.data)return t("Stream and Data fields are required",null,400);var e=JSON.stringify({data:this.params.data,table:this.params.stream,apiVersion:this.params.apiVersion,auth:this.params.auth?h.HmacSHA256(this.params.data,this.params.auth).toString(h.enc.Hex):""});this._sendRequest(e,"POST",t)},i.prototype.get=function(t){if(!this.params.stream||!this.params.data)return t("Stream and Data fields are required",null,null);var e,r=JSON.stringify({table:this.params.stream,data:this.params.data,apiVersion:this.params.apiVersion,auth:this.params.auth?h.HmacSHA256(this.params.data,this.params.auth).toString(h.enc.Hex):""});try{e=c.encode(r)}catch(n){throw new Error("Can't encode Base64 data: "+n)}this._sendRequest(e,"GET",t)},i.prototype.health=function(t){this._sendRequest("health","GET",t)},i.prototype._sendRequest=function(t,e,r){var n=this.xhr,i="health"==t?this.params.endpoint+"health":this.params.endpoint+"?data="+t;if(this.oldBrowser){var a;n.open(e,this.params.endpoint),n.onload=function(){console.log("[ONLOAD]: "+n.responseText),a=new s(null,n.responseText,200),r(null,a.data(),a.status)},n.onprogress=function(){},n.ontimeout=function(){console.log("[TIMEOUT]: GOT 500"),a=new s("No connection to server",null,500),r(a.err(),null,a.status)},n.onerror=function(){console.log("[ERROR]: GOT 500"),a=new s("Service Unavailable",null,500),r(a.err(),null,a.status)},"POST"===e?(n.open("POST",this.params.endpoint),n.send(t)):(n.open("GET",i),n.send())}else n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200==n.status?(a=new s(null,n.response,n.status),r(null,a.data(),a.status)):n.status>=400&&n.status<600?(a=new s(n.response,null,n.status),r(a.err(),null,a.status)):0==n.status&&(a=new s("No connection to server",null,500),r(a.err(),null,500)))},"POST"===e?(n.open("POST",this.params.endpoint,!0),this._setRequestHeaders(),n.send(t)):(n.open("GET",i,!0),this._setRequestHeaders(),n.send())},i.prototype._setRequestHeaders=function(){this.xhr.setRequestHeader("Content-type",this.headers.contentType),this.xhr.setRequestHeader("x-ironsource-atom-sdk-type",this.headers.sdkType),this.xhr.setRequestHeader("x-ironsource-atom-sdk-version",this.headers.sdkVersion)},s.prototype.data=function(){if(this.error)return null;try{return JSON.parse(this.response)}catch(t){return this.response}},s.prototype.err=function(){try{return JSON.parse(this.error)}catch(t){return this.error}},t.IronSourceAtom.Tracker=a,a.prototype.track=function(t,e){var n=this;if(t===r||0==t.length||0==e.length||e===r)throw new Error("Stream name and data are required parameters");if(t in n.accumulated||(n.accumulated[t]=[]),"string"==typeof e||e instanceof String)n.accumulated[t].push(e);else try{n.accumulated[t].push(JSON.stringify(e))}catch(i){throw new Error("Invalid Data - can't be stringified",i)}(n.accumulated[t].length>=n.params.bulkLen||o(n.accumulated[t])>=n.params.bulkSize)&&n.flush(t)},a.prototype.flush=function(t,e){function r(t,e,i,s,a){return a&&(n.accumulated[t]=[],a=!1),n.atom.putEvents({stream:t,data:e},function(n,o,u){return null!=n&&u>=500?i<12e5?void setTimeout(function(){i=2*i+Math.floor(1e3*Math.random()+100),r(t,e,i,s,a)},i):s("Timeout - No response from server",null,408):s(n,o,u)})}var n=this,i=this.retryTimeout;e||(e=function(t,e){return t?new Error(t):e});var s=[];if(t)n.accumulated[t].length>=1&&s.push(function(e){r(t,n.accumulated[t],i,e,!0)});else for(var a in n.accumulated)n.accumulated[a].length>=1&&!function(t){s.push(function(e){return r(t,n.accumulated[t],i,e,!0)})}(a);return u(s,e)};var h=h||function(t,e){var r={},n=r.lib={},i=n.Base=function(){function t(){}return{extend:function(e){t.prototype=this;var r=new t;return e&&r.mixIn(e),r.hasOwnProperty("init")||(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=n.WordArray=i.extend({init:function(t,r){t=this.words=t||[],r!=e?this.sigBytes=r:this.sigBytes=4*t.length},toString:function(t){return(t||o).stringify(this)},concat:function(t){var e=this.words,r=t.words,n=this.sigBytes,i=t.sigBytes;if(this.clamp(),n%4)for(var s=0;i>s;s++){var a=r[s>>>2]>>>24-s%4*8&255;e[n+s>>>2]|=a<<24-(n+s)%4*8}else for(var s=0;i>s;s+=4)e[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var r,n=[],i=function(e){var e=e,r=987654321,n=4294967295;return function(){r=36969*(65535&r)+(r>>16)&n,e=18e3*(65535&e)+(e>>16)&n;var i=(r<<16)+e&n;return i/=4294967296,i+=.5,i*(t.random()>.5?1:-1)}},a=0;e>a;a+=4){var o=i(4294967296*(r||t.random()));r=987654071*o(),n.push(4294967296*o()|0)}return new s.init(n,e)}}),a=r.enc={},o=a.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;r>i;i++){var s=e[i>>>2]>>>24-i%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;e>n;n+=2)r[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new s.init(r,e/2)}},u=a.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;r>i;i++){var s=e[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(s))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;e>n;n++)r[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new s.init(r,e)}},h=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},c=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=h.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r=this._data,n=r.words,i=r.sigBytes,a=this.blockSize,o=4*a,u=i/o;u=e?t.ceil(u):t.max((0|u)-this._minBufferSize,0);var h=u*a,c=t.min(4*h,i);if(h){for(var d=0;h>d;d+=a)this._doProcessBlock(n,d);var p=n.splice(0,h);r.sigBytes-=c}return new s.init(p,c)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),d=(n.Hasher=c.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new d.HMAC.init(t,r).finalize(e)}}}),r.algo={});return r}(Math);!function(t){var e=h,r=e.lib,n=r.WordArray,i=r.Hasher,s=e.algo,a=[],o=[];!function(){function e(e){for(var r=t.sqrt(e),n=2;r>=n;n++)if(!(e%n))return!1;return!0}function r(t){return 4294967296*(t-(0|t))|0}for(var n=2,i=0;64>i;)e(n)&&(8>i&&(a[i]=r(t.pow(n,.5))),o[i]=r(t.pow(n,1/3)),i++),n++}();var u=[],c=s.SHA256=i.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],s=r[2],a=r[3],h=r[4],c=r[5],d=r[6],p=r[7],l=0;64>l;l++){if(16>l)u[l]=0|t[e+l];else{var f=u[l-15],m=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,y=u[l-2],g=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;u[l]=m+u[l-7]+g+u[l-16]}var v=h&c^~h&d,S=n&i^n&s^i&s,_=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),w=(h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25),k=p+w+v+o[l]+u[l],C=_+S;p=d,d=c,c=h,h=a+k|0,a=s,s=i,i=n,n=k+C|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+s|0,r[3]=r[3]+a|0,r[4]=r[4]+h|0,r[5]=r[5]+c|0,r[6]=r[6]+d|0,r[7]=r[7]+p|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return r[i>>>5]|=128<<24-i%32,r[(i+64>>>9<<4)+14]=t.floor(n/4294967296),r[(i+64>>>9<<4)+15]=n,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=i._createHelper(c),e.HmacSHA256=i._createHmacHelper(c)}(Math),function(){var t=h,e=t.lib,r=e.Base,n=t.enc,i=n.Utf8,s=t.algo;s.HMAC=r.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=i.parse(e));var r=t.blockSize,n=4*r;e.sigBytes>n&&(e=t.finalize(e)),e.clamp();for(var s=this._oKey=e.clone(),a=this._iKey=e.clone(),o=s.words,u=a.words,h=0;r>h;h++)o[h]^=1549556828,u[h]^=909522486;s.sigBytes=a.sigBytes=n,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,r=e.finalize(t);e.reset();var n=e.finalize(this._oKey.clone().concat(r));return n}})}(),t.ironSourceAtomInit=t.ironSourceAtomInit||function(){},t.ironSourceAtomInit();var c={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,r,n,i,s,a,o,u="",h=0;for(t=c._utf8_encode(t);h<t.length;)e=t.charCodeAt(h++),r=t.charCodeAt(h++),n=t.charCodeAt(h++),i=e>>2,s=(3&e)<<4|r>>4,a=(15&r)<<2|n>>6,o=63&n,isNaN(r)?a=o=64:isNaN(n)&&(o=64),u=u+this._keyStr.charAt(i)+this._keyStr.charAt(s)+this._keyStr.charAt(a)+this._keyStr.charAt(o);return u},decode:function(t){var e,r,n,i,s,a,o,u="",h=0;for(t=t.replace(/[^A-Za-z0-9+\/=]/g,"");h<t.length;)i=this._keyStr.indexOf(t.charAt(h++)),s=this._keyStr.indexOf(t.charAt(h++)),a=this._keyStr.indexOf(t.charAt(h++)),o=this._keyStr.indexOf(t.charAt(h++)),e=i<<2|s>>4,r=(15&s)<<4|a>>2,n=(3&a)<<6|o,u+=String.fromCharCode(e),64!=a&&(u+=String.fromCharCode(r)),64!=o&&(u+=String.fromCharCode(n));return u=c._utf8_decode(u)},_utf8_encode:function(t){t=t.replace(/rn/g,"n");for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},_utf8_decode:function(t){for(var e="",r=0,n=0,i=0,s=0;r<t.length;)s=t.charCodeAt(r),s<128?(e+=String.fromCharCode(s),r++):s>191&&s<224?(i=t.charCodeAt(r+1),e+=String.fromCharCode((31&s)<<6|63&i),r+=2):(i=t.charCodeAt(r+1),n=t.charCodeAt(r+2),e+=String.fromCharCode((15&s)<<12|(63&i)<<6|63&n),r+=3);return e}}}(window,document);