!function(t,e,n){"use strict";function r(t){t=t||{};var e="https://track.atom-data.io/",n="V1",r="1.5.0",s="atom-js";this.options={endpoint:t.endpoint||e,apiVersion:n,auth:t.auth||"",sdkVersion:r,sdkType:s}}function s(t){if(this.params=t||{},"string"!=typeof t.data&&!(t.data instanceof String))try{this.params.data=JSON.stringify(this.params.data)}catch(e){throw new Error("data is invalid - can't be stringified")}this.headers={contentType:"application/json;charset=UTF-8",sdkType:this.params.sdkType,sdkVersion:this.params.sdkVersion},this.xhr=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}function i(t,e,n){this.error=t,this.response=e,this.status=n}function a(t){var e=this;this.retryTimeout=1e3,t=t||{},this.params=t,this.params.flushInterval=t.flushInterval?1e3*t.flushInterval:3e4,this.params.bulkLen=t.bulkLen?t.bulkLen:20,this.params.bulkSize=t.bulkSize?1024*t.bulkSize:40960,this.params.auth=t.auth?t.auth:"",this.accumulated={},this.atom=new r(t),this.timer||(this.timer=setInterval(function(){e.flush()},this.params.flushInterval))}function o(t){return encodeURI(t).split(/%..|./).length-1}function u(t,e){function n(t,n){t(function(t,i,a){if(r[n]={err:t,data:i,status:a},0===--s)return e(r)})}for(var r=[],s=t.length,i=0;i<t.length;i++)n(t[i],i)}t.IronSourceAtom=r,r.prototype.putEvent=function(t,e){if(t=t||{},!t.stream)return e("Stream is required",null,400);if(!t.data)return e("Data is required",null,400);t.apiVersion=this.options.apiVersion,t.sdkVersion=this.options.sdkVersion,t.sdkType=this.options.sdkType,t.auth=t.auth||this.options.auth,t.endpoint=t.endpoint||this.options.endpoint;var n=new s(t);return t.method&&"GET"===t.method.toUpperCase()?n.get(e):n.post(e)},r.prototype.putEvents=function(t,e){if(t=t||{},!t.stream)return e("Stream is required",null,400);if(!(t.data&&t.data instanceof Array&&t.data.length))return e("Data (must be not empty array) is required",null,400);if(t.method&&"GET"==t.method.toUpperCase())return e("GET is not a valid method for putEvents",null,400);t.apiVersion=this.options.apiVersion,t.auth=this.options.auth,t.sdkVersion=this.options.sdkVersion,t.sdkType=this.options.sdkType,t.endpoint=this.options.endpoint+"bulk";var n=new s(t);return n.post(e)},r.prototype.health=function(t){var e=this.options,n=new s(e);return n.health(t)},"undefined"!=typeof module&&module.exports&&(module.exports={IronSourceAtom:r,Request:s,Response:i,Tracker:a,taskMap:u}),s.prototype.post=function(t){if(!this.params.stream||!this.params.data)return t("Stream and Data fields are required",null,400);var e=this.xhr,n=JSON.stringify({data:this.params.data,table:this.params.stream,apiVersion:this.params.apiVersion,auth:this.params.auth?h.HmacSHA256(this.params.data,this.params.auth).toString(h.enc.Hex):""});e.open("POST",this.params.endpoint,!0),e.setRequestHeader("Content-type",this.headers.contentType),e.setRequestHeader("x-ironsource-atom-sdk-type",this.headers.sdkType),e.setRequestHeader("x-ironsource-atom-sdk-version",this.headers.sdkVersion),e.onreadystatechange=function(n){if(e.readyState===XMLHttpRequest.DONE){var r;200==e.status?(r=new i(null,e.response,e.status),t(null,r.data(),e.status)):e.status>=400&&e.status<600?(r=new i(e.response,null,e.status),t(r.err(),null,e.status)):0==e.status&&t("No connection to server",null,500)}},e.send(n)},s.prototype.get=function(t){if(!this.params.stream||!this.params.data)return t("Stream and Data fields are required",null,null);var e,n=this.xhr,r=JSON.stringify({table:this.params.stream,data:this.params.data,apiVersion:this.params.apiVersion,auth:this.params.auth?h.HmacSHA256(this.params.data,this.params.auth).toString(h.enc.Hex):""});try{e=btoa(r)}catch(s){}n.open("GET",this.params.endpoint+"?data="+e,!0),n.setRequestHeader("Content-type",this.headers.contentType),n.setRequestHeader("x-ironsource-atom-sdk-type",this.headers.sdkType),n.setRequestHeader("x-ironsource-atom-sdk-version",this.headers.sdkVersion),n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE){var e;200==n.status?(e=new i(null,n.response,n.status),t(null,e.data(),n.status)):n.status>=400&&n.status<600?(e=new i(n.response,null,n.status),t(e.err(),null,n.status)):0==n.status&&t("No connection to server",null,500)}},n.send()},s.prototype.health=function(t){var e=this.xhr;e.open("GET",this.params.endpoint+"health",!0),e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE){var n;200==e.status?(n=new i(null,e.response,e.status),!!t&&t(null,n.data(),e.status)):(n=new i(e.response,null,e.status),!!t&&t(n.err(),null,e.status))}},e.send()},i.prototype.data=function(){if(this.error)return null;try{return JSON.parse(this.response)}catch(t){return this.response}},i.prototype.err=function(){try{return JSON.parse(this.error)}catch(t){return this.error}},t.IronSourceAtom.Tracker=a,a.prototype.track=function(t,e){var r=this;if(t===n||0==t.length||0==e.length||e===n)throw new Error("Stream name and data are required parameters");if(t in r.accumulated||(r.accumulated[t]=[]),"string"==typeof e||e instanceof String)r.accumulated[t].push(e);else try{r.accumulated[t].push(JSON.stringify(e))}catch(s){throw new Error("Invalid Data - can't be stringified",s)}(r.accumulated[t].length>=r.params.bulkLen||o(r.accumulated[t])>=r.params.bulkSize)&&r.flush(t)},a.prototype.flush=function(t,e){function n(t,e,s,i,a){return a&&(r.accumulated[t]=[],a=!1),r.atom.putEvents({stream:t,data:e},function(r,o,u){return null!=r&&u>=500?s<12e5?void setTimeout(function(){s=2*s+Math.floor(1e3*Math.random()+100),n(t,e,s,i,a)},s):i("Timeout - No response from server",null,408):i(r,o,u)})}var r=this,s=this.retryTimeout;e||(e=function(t,e){return t?new Error(t):e});var i=[];if(t)r.accumulated[t].length>=1&&i.push(function(e){n(t,r.accumulated[t],s,e,!0)});else for(var a in r.accumulated)r.accumulated[a].length>=1&&!function(t){i.push(function(e){return n(t,r.accumulated[t],s,e,!0)})}(a);return u(i,e)};var h=h||function(t,e){var n={},r=n.lib={},s=r.Base=function(){function t(){}return{extend:function(e){t.prototype=this;var n=new t;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),i=r.WordArray=s.extend({init:function(t,n){t=this.words=t||[],n!=e?this.sigBytes=n:this.sigBytes=4*t.length},toString:function(t){return(t||o).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,s=t.sigBytes;if(this.clamp(),r%4)for(var i=0;s>i;i++){var a=n[i>>>2]>>>24-i%4*8&255;e[r+i>>>2]|=a<<24-(r+i)%4*8}else for(var i=0;s>i;i+=4)e[r+i>>>2]=n[i>>>2];return this.sigBytes+=s,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=s.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n,r=[],s=function(e){var e=e,n=987654321,r=4294967295;return function(){n=36969*(65535&n)+(n>>16)&r,e=18e3*(65535&e)+(e>>16)&r;var s=(n<<16)+e&r;return s/=4294967296,s+=.5,s*(t.random()>.5?1:-1)}},a=0;e>a;a+=4){var o=s(4294967296*(n||t.random()));n=987654071*o(),r.push(4294967296*o()|0)}return new i.init(r,e)}}),a=n.enc={},o=a.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],s=0;n>s;s++){var i=e[s>>>2]>>>24-s%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;e>r;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new i.init(n,e/2)}},u=a.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],s=0;n>s;s++){var i=e[s>>>2]>>>24-s%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;e>r;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new i.init(n,e)}},h=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},c=r.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=h.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,s=n.sigBytes,a=this.blockSize,o=4*a,u=s/o;u=e?t.ceil(u):t.max((0|u)-this._minBufferSize,0);var h=u*a,c=t.min(4*h,s);if(h){for(var p=0;h>p;p+=a)this._doProcessBlock(r,p);var d=r.splice(0,h);n.sigBytes-=c}return new i.init(d,c)},clone:function(){var t=s.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),p=(r.Hasher=c.extend({cfg:s.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new p.HMAC.init(t,n).finalize(e)}}}),n.algo={});return n}(Math);!function(t){var e=h,n=e.lib,r=n.WordArray,s=n.Hasher,i=e.algo,a=[],o=[];!function(){function e(e){for(var n=t.sqrt(e),r=2;n>=r;r++)if(!(e%r))return!1;return!0}function n(t){return 4294967296*(t-(0|t))|0}for(var r=2,s=0;64>s;)e(r)&&(8>s&&(a[s]=n(t.pow(r,.5))),o[s]=n(t.pow(r,1/3)),s++),r++}();var u=[],c=i.SHA256=s.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],s=n[1],i=n[2],a=n[3],h=n[4],c=n[5],p=n[6],d=n[7],l=0;64>l;l++){if(16>l)u[l]=0|t[e+l];else{var f=u[l-15],m=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,y=u[l-2],v=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;u[l]=m+u[l-7]+v+u[l-16]}var g=h&c^~h&p,w=r&s^r&i^s&i,S=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),k=(h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25),_=d+k+g+o[l]+u[l],H=S+w;d=p,p=c,c=h,h=a+_|0,a=i,i=s,s=r,r=_+H|0}n[0]=n[0]+r|0,n[1]=n[1]+s|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+h|0,n[5]=n[5]+c|0,n[6]=n[6]+p|0,n[7]=n[7]+d|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,s=8*e.sigBytes;return n[s>>>5]|=128<<24-s%32,n[(s+64>>>9<<4)+14]=t.floor(r/4294967296),n[(s+64>>>9<<4)+15]=r,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=s._createHelper(c),e.HmacSHA256=s._createHmacHelper(c)}(Math),function(){var t=h,e=t.lib,n=e.Base,r=t.enc,s=r.Utf8,i=t.algo;i.HMAC=n.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=s.parse(e));var n=t.blockSize,r=4*n;e.sigBytes>r&&(e=t.finalize(e)),e.clamp();for(var i=this._oKey=e.clone(),a=this._iKey=e.clone(),o=i.words,u=a.words,h=0;n>h;h++)o[h]^=1549556828,u[h]^=909522486;i.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,n=e.finalize(t);e.reset();var r=e.finalize(this._oKey.clone().concat(n));return r}})}(),t.ironSourceAtomInit=t.ironSourceAtomInit||function(){},t.ironSourceAtomInit()}(window,document);